<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin TOPVIBES</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
    body{background:#111;color:#fff;padding:20px}
    h1,h2{margin:15px 0 10px;font-size:1.5rem}
    input,textarea,button{padding:10px;margin:5px 0;width:100%;border:none;border-radius:5px}
    input,textarea{background:#222;color:#fff}
    button{background:#ff3333;color:#fff;cursor:pointer;font-weight:bold}
    button:hover{background:#cc0000}
    .section{margin-bottom:30px;padding:15px;background:#1a1a1a;border-radius:8px}
    .shirts-list{margin-top:10px}
    .shirt-item{margin:10px 0;padding:10px;background:#222;border-radius:5px}
    .add-shirt{background:#333;color:#0f0;border:none;cursor:pointer;margin-top:5px}
    .remove-shirt{background:#900;color:#fff;border:none;cursor:pointer;margin-left:5px}
    .photo-inputs input{width:calc(100% - 10px);margin:2px}
  </style>
</head>
<body>
  <h1>ADMIN TOPVIBES</h1>

  <!-- HERO -->
  <div class="section">
    <h2>Hero</h2>
    <input id="heroTitle" placeholder="Título" />
    <textarea id="heroDesc" placeholder="Descripción" rows="2"></textarea>
  </div>

  <!-- ABOUT -->
  <div class="section">
    <h2>About</h2>
    <input id="aboutTitle" placeholder="Título" />
    <textarea id="aboutDesc1" placeholder="Párrafo 1" rows="3"></textarea>
    <textarea id="aboutDesc2" placeholder="Párrafo 2" rows="3"></textarea>
  </div>

  <!-- TELEGRAM -->
  <div class="section">
    <h2>Telegram</h2>
    <input id="telegramTitle" placeholder="Título" />
    <textarea id="telegramDesc" placeholder="Descripción" rows="2"></textarea>
    <input id="telegramLink" placeholder="Link" />
  </div>

  <!-- CAMISETAS -->
  <div class="section">
    <h2>Camisetas</h2>
    <input id="shirtsTitle" placeholder="Título de sección" />
    <div id="shirtsList" class="shirts-list"></div>
    <button class="add-shirt" onclick="addShirt()">+ Añadir camiseta</button>
  </div>

  <!-- DESCUENTOS -->
  <div class="section">
    <h2>Descuentos</h2>
    <input id="discountsTitle" placeholder="Título" />
    <textarea id="discountsDesc" placeholder="Descripción" rows="2"></textarea>
    <input id="discountsCodes" placeholder="Códigos separados por coma" />
    <input id="newPrice" placeholder="Precio nuevo (ej: 19.99)" />
  </div>

  <!-- FOOTER -->
  <div class="section">
    <h2>Footer</h2>
    <input id="footerYear" placeholder="Año" />
    <input id="footerIg" placeholder="Instagram link" />
    <input id="footerTt" placeholder="TikTok link" />
    <input id="footerYt" placeholder="YouTube link" />
  </div>

  <button onclick="saveAll()">GUARDAR TODO</button>
  <p id="status" style="margin-top:15px;color:#0f0"></p>

  <script>
    const API = 'https://topvibes-production.up.railway.app'; // CAMBIA SI ES OTRO DOMINIO

    async function loadData() {
      try {
        const res = await fetch(API + '/api/data');
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        $('#heroTitle').value = data.hero?.title || '';
        $('#heroDesc').value = data.hero?.desc || '';
        $('#aboutTitle').value = data.about?.title || '';
        $('#aboutDesc1').value = data.about?.desc1 || '';
        $('#aboutDesc2').value = data.about?.desc2 || '';
        $('#telegramTitle').value = data.telegram?.title || '';
        $('#telegramDesc').value = data.telegram?.desc || '';
        $('#telegramLink').value = data.telegram?.link || '';
        $('#shirtsTitle').value = data.shirtsTitle || '';
        $('#shirtsList').innerHTML = '';
        (data.shirts || []).forEach(addShirt);
        $('#discountsTitle').value = data.discounts?.title || '';
        $('#discountsDesc').value = data.discounts?.desc || '';
        $('#discountsCodes').value = (data.discounts?.validCodes || []).join(', ');
        $('#newPrice').value = data.discounts?.newPrice || '';
        $('#footerYear').value = data.footer?.year || '';
        $('#footerIg').value = data.footer?.ig || '';
        $('#footerTt').value = data.footer?.tt || '';
        $('#footerYt').value = data.footer?.yt || '';

        $('#status').textContent = 'Datos cargados';
      } catch (e) {
        $('#status').textContent = 'Error al cargar: ' + e.message;
        $('#status').style.color = '#f00';
      }
    }

    async function saveAll() {
      const payload = {
        hero: { title: $('#heroTitle').value, desc: $('#heroDesc').value },
        about: { title: $('#aboutTitle').value, desc1: $('#aboutDesc1').value, desc2: $('#aboutDesc2').value },
        telegram: { title: $('#telegramTitle').value, desc: $('#telegramDesc').value, link: $('#telegramLink').value },
        shirtsTitle: $('#shirtsTitle').value,
        shirts: Array.from(document.querySelectorAll('.shirt-item')).map(el => ({
          id: el.dataset.id || Date.now().toString(),
          name: el.querySelector('.name').value,
          price: el.querySelector('.price').value,
          oldPrice: el.querySelector('.oldPrice').value || '24.99',
          img: el.querySelector('.img').value,
          desc: el.querySelector('.desc').value,
          vinted1: el.querySelector('.vinted1').value,
          vinted2: el.querySelector('.vinted2').value,
          wallapop: el.querySelector('.wallapop').value,
          size: el.querySelector('.size').value,
          pdf: el.querySelector('.pdf').value,
          photos: Array.from(el.querySelectorAll('.photo-inputs input')).map(i => i.value.trim()).filter(Boolean)
        })),
        discounts: {
          title: $('#discountsTitle').value,
          desc: $('#discountsDesc').value,
          validCodes: $('#discountsCodes').value.split(',').map(s => s.trim()).filter(Boolean),
          newPrice: $('#newPrice').value
        },
        footer: { year: $('#footerYear').value, ig: $('#footerIg').value, tt: $('#footerTt').value, yt: $('#footerYt').value }
      };

      try {
        const res = await fetch(API + '/api/update-all', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        $('#status').textContent = '¡Guardado! index.html actualizado en GitHub Pages.';
        $('#status').style.color = '#0f0';
      } catch (e) {
        $('#status').textContent = 'Error: ' + e.message;
        $('#status').style.color = '#f00';
      }
    }

    function addShirt(s = {}) {
      const list = $('#shirtsList');
      const div = document.createElement('div');
      div.className = 'shirt-item';
      div.dataset.id = s.id || Date.now();
      div.innerHTML = `
        <input class="name" placeholder="Nombre" value="${s.name||''}" />
        <input class="price" placeholder="Precio nuevo" value="${s.price||''}" />
        <input class="oldPrice" placeholder="Precio viejo" value="${s.oldPrice||''}" />
        <input class="img" placeholder="Imagen principal" value="${s.img||''}" />
        <textarea class="desc" placeholder="Descripción" rows="2">${s.desc||''}</textarea>
        <input class="vinted1" placeholder="Vinted 1" value="${s.vinted1||''}" />
        <input class="vinted2" placeholder="Vinted 2" value="${s.vinted2||''}" />
        <input class="wallapop" placeholder="Wallapop" value="${s.wallapop||''}" />
        <input class="size" placeholder="Talla" value="${s.size||''}" />
        <input class="pdf" placeholder="PDF tallas" value="${s.pdf||''}" />
        <div class="photo-inputs">
          ${(s.photos||[]).map(p => `<input placeholder="Foto extra" value="${p}" />`).join('')}
          <input placeholder="Foto extra (añade más)" />
        </div>
        <button class="remove-shirt" onclick="this.parentElement.remove()">Eliminar</button>
      `;
      list.appendChild(div);
    }

    function $(s) { return document.getElementById(s.replace('#','')); }

    window.onload = loadData;
  </script>
</body>
</html>
